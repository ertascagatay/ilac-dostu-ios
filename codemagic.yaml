workflows:
  ios-simulator-build:
    name: iOS Simulator Build for Appetize
    instance_type: mac_mini_m1
    max_build_duration: 60
    environment:
      flutter: stable
      xcode: 16.2
      cocoapods: default
    scripts:
      - name: Clean previous builds
        script: |
          cd ilac_dostu
          flutter clean
          cd ios
          rm -rf Pods Podfile.lock .symlinks
          cd ../..
      
      - name: Get Flutter packages
        script: |
          cd ilac_dostu
          flutter pub get
      
      - name: Install CocoaPods dependencies
        script: |
          cd ilac_dostu/ios
          pod install --repo-update
      
      - name: Build iOS Simulator app
        script: |
          cd ilac_dostu
          flutter build ios --debug --no-codesign --simulator
      
      - name: Package for Appetize
        script: |
          cd ilac_dostu/build/ios/iphonesimulator
          ditto -c -k --sequesterRsrc --keepParent Runner.app Runner.zip
    
    artifacts:
      - ilac_dostu/build/ios/iphonesimulator/Runner.zip
